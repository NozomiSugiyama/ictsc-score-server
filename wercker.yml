box: ruby:2.3.0

build:
  steps:
    - script:
        name: set nodejs environment
        code: |
          sudo apt-get update
          sudo apt-get install -y nodejs
          sudo npm config set registry http://registry.npmjs.org/
          sudo npm install -g grunt-cli
          cd design
          npm install
    - script:
        name: bower install
        code: |
          cd design
          bower install
    - script:
        name: gulp build
        code: |
          cd design
          $(npm bin)/gulp build
    - bundle-install
    - script:
        name: migrate database
        code: bundle exec rake db:migrate
    - script:
        name: load seed data into database
        code: bundle exec rake db:seed_fu
    - script:
        name: run rspec
        code: bundle exec rspec spec
  after-steps:
    - wantedly/pretty-slack-notify:
        webhook_url: $SLACK_WEBHOOK_URL
